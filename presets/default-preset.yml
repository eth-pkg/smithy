type: object
required:
  - commonConfig
properties:
  commonConfig:
    type: object
    required:
      - clients
    properties:
      networkId:
        type: number
        minimum: 1
        default: 1
        errorMessage:
          minimum: "Network ID must be a positive number"
      clients:
        type: object
        required:
          - consensus
          - execution
        properties:
          consensus:
            type: string
            enum:
              - lighthouse
              - lodestar
              - nimbus-eth2
              - prysm
              - teku
            errorMessage:
              enum: "Consensus client must be one of: lighthouse, prysm, teku"
            default: ""
          execution:
            type: string
            enum:
              - besu
              - erigon 
              - geth
              - nethermind
              - reth
            errorMessage:
              enum: "Execution client must be one of: geth, nethermind, besu"
            default: ""
          validator:
            type: string
            enum:
              - lighthouse
              - lodestar
              - nimbus-eth2
              - prysm
              - teku
              - ""
            errorMessage:
              enum: "Validator client must be one of: lighthouse, prysm, teku, or empty string"
            default: ""
      dataDir:
        type: string
        default: "$HOME/ethereum/mainnet"
      engine:
        type: object
        properties:
          apiPort:
            type: number
            minimum: 1024
            maximum: 65535
            default: 8551
            errorMessage:
              minimum: "Engine API port must be >= 1024"
              maximum: "Engine API port must be <= 65535"
          communication:
            type: string
            enum:
              - jwt
            default: "jwt"
            errorMessage:
              enum: "Engine communication method must be 'jwt'"
          endpointUrl:
            type: string
            pattern: "^https?://[a-zA-Z0-9.-]+(:[0-9]+)?$"
            default: "http://localhost:8551"
            errorMessage:
              pattern: "Engine endpoint URL must be a valid http or https URL"
          host:
            type: string
            default: "localhost"
          ip:
            type: string
            pattern: "^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"
            default: "127.0.0.1"
            errorMessage:
              pattern: "Must be a valid IPv4 address"
          jwtFile:
            type: string
            default: "$HOME/ethereum/mainnet/jwt.hex"
          scheme:
            type: string
            enum:
              - http
              - https
            default: "http"
            errorMessage:
              enum: "Engine scheme must be either 'http' or 'https'"
      features:
        type: object
        properties:
          mevBoost:
            type: boolean
            default: false
          monitoring:
            type: boolean
            default: true
          staking:
            type: boolean
            default: false
      network:
        type: string
        enum:
          - mainnet
          - goerli
          - sepolia
          - holesky
          - hoodie
          - ephemery
          - custom
        default: "mainnet"
        errorMessage:
          enum: "Network must be one of: mainnet, goerli, sepolia, holesky, hoodie, ephemery, custom"
      operatingSystem:
        type: string
        enum:
          - linux
          - darwin
          - windows
        default: "linux"
        errorMessage:
          enum: "Operating system must be one of: linux, darwin, windows"
      syncMode:
        type: string
        enum:
          - snap
          - full
          - light
        default: "snap"
        errorMessage:
          enum: "Sync mode must be one of: snap, full, light"
  consensusConfig:
    type: object
    properties:
      httpPort:
        type: number
        minimum: 1024
        maximum: 65535
        default: 5052
        errorMessage:
          minimum: "HTTP port must be >= 1024"
          maximum: "HTTP port must be <= 65535"
      metricsPort:
        type: number
        minimum: 1024
        maximum: 65535
        default: 8008
        errorMessage:
          minimum: "Metrics port must be >= 1024"
          maximum: "Metrics port must be <= 65535"
      p2pPort:
        type: number
        minimum: 1024
        maximum: 65535
        default: 9000
        errorMessage:
          minimum: "P2P port must be >= 1024"
          maximum: "P2P port must be <= 65535"
  executionConfig:
    type: object
    properties:
      http:
        type: object
        properties:
          apiPrefixes:
            type: array
            minItems: 1
            default: ["eth", "net", "web3"]
            items:
              type: string
          cors:
            type: array
            default: ["*"]
            items:
              type: string
          enabled:
            type: boolean
            default: true
          port:
            type: number
            minimum: 1024
            maximum: 65535
            default: 8545
            errorMessage:
              minimum: "HTTP port must be >= 1024"
              maximum: "HTTP port must be <= 65535"
      metrics:
        type: object
        properties:
          enabled:
            type: boolean
            default: true
          port:
            type: number
            minimum: 1024
            maximum: 65535
            default: 6060
            errorMessage:
              minimum: "Metrics port must be >= 1024"
              maximum: "Metrics port must be <= 65535"
      p2p:
        type: object
        properties:
          maxPeers:
            type: number
            minimum: 1
            maximum: 1000
            default: 50
            errorMessage:
              minimum: "Max peers must be at least 1"
              maximum: "Max peers should not exceed 1000"
          port:
            type: number
            minimum: 1024
            maximum: 65535
            default: 30303
            errorMessage:
              minimum: "P2P port must be >= 1024"
              maximum: "P2P port must be <= 65535"
      ws:
        type: object
        properties:
          enabled:
            type: boolean
            default: false
          port:
            type: number
            minimum: 1024
            maximum: 65535
            default: 8546
            errorMessage:
              minimum: "WebSocket port must be >= 1024"
              maximum: "WebSocket port must be <= 65535"

# Custom validation rule for validator client when staking is enabled
if:
  type: object
  properties:
    commonConfig:
      type: object
      properties:
        features:
          type: object
          properties:
            staking:
              type: boolean
              const: true
then:
  type: object
  properties:
    commonConfig:
      type: object
      properties:
        clients:
          type: object
          required:
            - validator
          properties:
            validator:
              type: string
              minLength: 1
              errorMessage:
                minLength: "Validator client is required when staking is enabled"